#:import hex kivy.utils.get_color_from_hex

<RootWidget>:
    orientation: 'vertical'
    padding: dp(10)
    spacing: dp(10)
    canvas.before:
        Color:
            rgba: root.theme["bg"]
        Rectangle:
            pos: self.pos
            size: self.size

    BoxLayout:
        size_hint_y: None
        height: dp(40)
        spacing: dp(10)

        Label:
            text: "API Key (sk_...):"
            color: root.theme["fg"]
            size_hint_x: None
            width: dp(150)

        TextInput:
            text: root.api_key
            multiline: False
            background_color: root.theme["entry_bg"]
            foreground_color: root.theme["entry_fg"]
            cursor_color: root.theme["entry_fg"]
            on_text: root.api_key = self.text

        Button:
            text: "Save API Key"
            size_hint_x: None
            width: dp(100)
            background_color: root.theme["button_bg"]
            color: root.theme["button_fg"]
            on_release: root.save_api_key()

        Button:
            text: "Toggle Light/Dark"
            size_hint_x: None
            width: dp(140)
            background_color: root.theme["button_bg"]
            color: root.theme["button_fg"]
            on_release: root.toggle_theme()

    BoxLayout:
        size_hint_y: None
        height: dp(40)
        spacing: dp(10)

        Label:
            text: "Handshake file:"
            color: root.theme["fg"]
            size_hint_x: None
            width: dp(150)

        TextInput:
            text: root.file_path
            multiline: False
            background_color: root.theme["entry_bg"]
            foreground_color: root.theme["entry_fg"]
            cursor_color: root.theme["entry_fg"]
            on_text: root.file_path = self.text

        Button:
            text: "Browse"
            size_hint_x: None
            width: dp(100)
            background_color: root.theme["button_bg"]
            color: root.theme["button_fg"]
            on_release: root.open_file_chooser()

    BoxLayout:
        orientation: 'vertical'
        size_hint_y: None
        height: dp(140)

        Label:
            text: "Paste hashes (one per line):"
            color: root.theme["fg"]
            size_hint_y: None
            height: dp(20)

        TextInput:
            id: hashes_input
            text: ""
            background_color: root.theme["entry_bg"]
            foreground_color: root.theme["entry_fg"]
            cursor_color: root.theme["entry_fg"]
            multiline: True

    BoxLayout:
        size_hint_y: None
        height: dp(50)
        spacing: dp(10)

        Button:
            text: "Upload"
            background_color: root.theme["button_bg"]
            color: root.theme["button_fg"]
            on_release: root.upload()

        Button:
            text: "Fetch Tasks"
            background_color: root.theme["button_bg"]
            color: root.theme["button_fg"]
            on_release: root.fetch_tasks()

    Label:
        text: "Log:"
        color: root.theme["fg"]
        size_hint_y: None
        height: dp(20)

    ScrollView:
        size_hint_y: 0.3
        do_scroll_x: False

        Label:
            text: root.log_text
            color: root.theme["text_fg"]
            text_size: self.width, None
            size_hint_y: None
            height: self.texture_size[1]
            markup: True

    Label:
        text: "Tasks:"
        color: root.theme["fg"]
        size_hint_y: None
        height: dp(20)

    ScrollView:
        size_hint_y: 0.3
        do_scroll_x: False

        Label:
            text: root.tasks_text
            color: root.theme["text_fg"]
            text_size: self.width, None
            size_hint_y: None
            height: self.texture_size[1]
            markup: True

<FileChooserPopup>:
    title: "Select handshake file"
    size_hint: 0.9, 0.9
    auto_dismiss: False
    BoxLayout:
        orientation: 'vertical'
        FileChooserListView:
            id: filechooser
            filters: ['*.cap', '*.pcap', '*.pcapng', '*.hc22000']
        BoxLayout:
            size_hint_y: None
            height: dp(40)
            spacing: dp(10)
            Button:
                text: "Cancel"
                on_release: root.dismiss()
            Button:
                text: "Select"
                on_release:
                    root.select(filechooser.path + "/" + filechooser.selection[0] if filechooser.selection else "")
                    root.dismiss()
